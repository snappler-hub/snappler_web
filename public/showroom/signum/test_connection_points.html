<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Signum</title>
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css"/>
  <link rel="stylesheet" href="app/assets/signum-main.css"/>
</head>

<body role="document" oncontextmenu="return false;">

<!-- Fixed navbar -->
<div class="navbar navbar-default navbar-static-top" role="navigation">
  <div class="container">
    <table id="ver-minimalist">
      <thead>
      <tr onclick="$('tbody').fadeToggle(0);">
        <th scope="col">Buzones</th>
        <th scope="col">Transformadores</th>
        <th scope="col" colspan="2">Cables y Lineas</th>
        <th scope="col">Postes</th>
        <th scope="col">Seccionadores</th>
        <th scope="col">Celdas</th>
        <th scope="col">PAT y Desc.</th>
      </tr>
      </thead>

      <tbody>
      <tr>
        <td>
          <img class="marker" data-class="buzon" src="app/assets/images/iconos_signum/buzones_caja/buzon_6campos.svg"/>
          <img class="marker" data-class="caja" src="app/assets/images/iconos_signum/buzones_caja/caja_country.svg"/>
          <img class="marker" data-class="caja" src="app/assets/images/iconos_signum/buzones_caja/caja_monoblock.svg"/>
        </td>
        <td>
          <img class="marker" data-class="transformador"
               src="app/assets/images/iconos_signum/transformadores/transformador_bifasico.svg"/>
          <img class="marker" data-class="transformador"
               src="app/assets/images/iconos_signum/transformadores/transformador_bifasico_rural.svg"/>
          <img class="marker" data-class="transformador"
               src="app/assets/images/iconos_signum/transformadores/transformador_trifasico.svg"/>
        </td>

        <td>
          <span>MT</span>
          <img class="line mt" data-class="linea mt" src="app/assets/images/iconos_signum/lineas/linea_mt.svg"/>
          <img class="line mt dashed" data-class="linea mt punteada"
               src="app/assets/images/iconos_signum/lineas/linea_mt_punteada.svg"/>
        </td>
        <td>
          <span>BT</span>
          <img class="line bt" data-class="linea bt" src="app/assets/images/iconos_signum/lineas/linea_bt.svg"/>
          <img class="line bt dashed" data-class="linea bt punteada"
               src="app/assets/images/iconos_signum/lineas/linea_bt_punteada.svg"/>
        </td>

        <td class="small">
          <img class="marker" data-class="retencion"
               src="app/assets/images/iconos_signum/suspension_retencion/retencion_bitubular.svg"/>
          <img class="marker" data-class="retencion"
               src="app/assets/images/iconos_signum/suspension_retencion/retencion_doble_hormigon.svg"/>
          <img class="marker" data-class="retencion"
               src="app/assets/images/iconos_signum/suspension_retencion/retencion_madera.svg"/>
          <img class="marker" data-class="retencion"
               src="app/assets/images/iconos_signum/suspension_retencion/retencion_madera_tratado.svg"/>
          <img class="marker" data-class="retencion"
               src="app/assets/images/iconos_signum/suspension_retencion/retencion_monoposte_hormigon.svg"/>
          <img class="marker" data-class="suspension"
               src="app/assets/images/iconos_signum/suspension_retencion/suspension.svg"/>
        </td>
        <td>
          <img class="marker" data-class="reconectador"
               src="app/assets/images/iconos_signum/seccionador/reconectador.svg"/>
          <img class="marker" data-class="seccionador"
               src="app/assets/images/iconos_signum/seccionador/seccionador.svg"/>
          <img class="marker" data-class="seccionador"
               src="app/assets/images/iconos_signum/seccionador/seccionador_autodesconectador.svg"/>
          <img class="marker" data-class="seccionador"
               src="app/assets/images/iconos_signum/seccionador/seccionador_bajo_carga.svg"/>
          <img class="marker" data-class="seccionalizador"
               src="app/assets/images/iconos_signum/seccionador/seccionalizador.svg"/>
        </td>
        <td>
          <img class="marker" data-class="celda" src="app/assets/images/iconos_signum/celdas/celda_interruptor.svg"/>
          <img class="marker" data-class="celda" src="app/assets/images/iconos_signum/celdas/celda_medicion.svg"/>
          <img class="marker" data-class="celda" src="app/assets/images/iconos_signum/celdas/celda_remonte.svg"/>
          <img class="marker" data-class="celda" src="app/assets/images/iconos_signum/celdas/celda_rotadora.svg"/>
          <img class="marker" data-class="celda" src="app/assets/images/iconos_signum/celdas/celda_ruptofusible.svg"/>
          <img class="marker" data-class="celda" src="app/assets/images/iconos_signum/celdas/celda_seccionadora.svg"/>
        </td>
        <td>
          <img class="marker" data-class="des"
               src="app/assets/images/iconos_signum/descargadores/descargadores_sobretension.svg"/>
          <img class="marker" data-class="pat" src="app/assets/images/iconos_signum/puesto_tierra/puesta_a_tierra.svg"/>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>


<div id="map" data-role="main"></div>
<div id="pos_svg">
  <svg id="svg"></svg>
</div>

<ul class="context-menu"></ul>
<div id="slider"></div>
<!-- ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>

<!-- Leaflet -->
<script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>

<!-- Leaflet.GeometryUtil -->
<script src="vendor/Leaflet.GeometryUtil/dist/leaflet.geometryutil.js"></script>

<!-- Leaflet.Plugins -->
<script src="vendor/Leaflet.plugins/layer/Marker.Rotate.js"></script>

<!-- Snap.svg -->
<script src="vendor/Snap.svg/dist/snap.svg.js"></script>

<script src="app/src/Util.js" type="text/javascript"></script>
<script src="app/src/Tooltip.js" type="text/javascript"></script>
<script src="app/src/Marker.js" type="text/javascript"></script>
<script src="app/src/GuideMarker.js" type="text/javascript"></script>
<script src="app/src/CircleMarker.js" type="text/javascript"></script>
<script src="app/src/PinkCircleMarker.js" type="text/javascript"></script>
<script src="app/src/TransparentCircleMarker.js" type="text/javascript"></script>
<script src="app/src/Polygon.js" type="text/javascript"></script>
<script src="app/src/Line.js" type="text/javascript"></script>
<script src="app/src/EditableLine.js" type="text/javascript"></script>
<script src="app/src/DashedLine.js" type="text/javascript"></script>
<script src="app/src/Rectangle.js" type="text/javascript"></script>
<script src="app/src/DashedRectangle.js" type="text/javascript"></script>
<script src="app/src/Circle.js" type="text/javascript"></script>
<script src="app/src/DashedCircle.js" type="text/javascript"></script>

<script src="app/src/control/CursorControl.js" type="text/javascript"></script>
<script src="app/src/control/MarkerControl.js" type="text/javascript"></script>
<script src="app/src/control/LineControl.js" type="text/javascript"></script>
<script src="app/src/control/PolygonControl.js" type="text/javascript"></script>

<script src="app/src/map/MapLeaflet.js" type="text/javascript"></script>
<script src="app/src/Application.js" type="text/javascript"></script>


<!--   DATA FOR CONNECTION POINTS EXAMPLE    -->
<script src="app/data/data_signum.js" type="text/javascript"></script>


<script type="text/javascript">
  $( document ).ready( function () {
    var map = new Map();
    Application.setup();


    iconAnchor=64;
    m_ex = L.marker( signum.data.coordenate, {clickable: false,
      icon: L.icon( {iconUrl: signum.data.image,
        iconSize: [iconAnchor*2, iconAnchor*2],
        iconAnchor: [iconAnchor, iconAnchor]} )} ).addTo( map );


    s = Snap("#svg");
    layer_point_marker=map.latLngToLayerPoint( signum.data.coordenate);
    var top = layer_point_marker.y+iconAnchor+15;
    var left=layer_point_marker.x-iconAnchor+3;
    var topOffset=$('.navbar' ).height()+3;

    s.attr({
      width:"200",
      height:"150",
      viewBox: left +' '+(top-topOffset)+' 200 150',
      preserveAspectRatio: "xMinYMin meet"
    });

    $('#pos_svg').css("width","120");
    $('#pos_svg').css("height", "100");
    $('#pos_svg').css("top", top);
    $('#pos_svg').css("left", left);
    $('#pos_svg').css("position", "absolute");

    a_snap_circ=[];

    signum.data.connect.forEach(function(p, i){
      trans_point={x: p.x - iconAnchor, y: p.y - iconAnchor};

//      (new CircleMarker()).setLatLng(map.layerPointToLatLng( L.point(layer_point_marker.x+trans_point.x,layer_point_marker.y-trans_point.y ) ) ).addTo(map);

      circ_connect = s.circle(layer_point_marker.x+trans_point.x, layer_point_marker.y-trans_point.y, 8).attr({
        fill: "#bada55",
        stroke: "#000",
        strokeWidth: 2,
        opacity:1
      });
      circ_connect._position={x: layer_point_marker.x+trans_point.x, y: layer_point_marker.y-trans_point.y};

      circ_connect.click(function(){
        a_snap_circ.forEach(function(c){
          c.attr({ fill: "#bada55" });
        });

        this.attr({ fill: 'blue' });

        console.log(map.layerPointToLatLng( L.point(this._position.x,this._position.y ) ));
      });

//      group_circs.add(circ_connect);
      a_snap_circ.push(circ_connect);
    });

  } );
  //L.Util.falseFn
</script>
</body>
</html>
